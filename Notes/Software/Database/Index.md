

ุงูุฏฺฉุณโูุง ุฏุฑDB ุจุฑุง ุงูุฒุงุด ุณุฑุนุช ุฌุณุชุฌููุง ุงุณุชูุงุฏู ูโุดููุฏ.  ูุซู ููุฑุณุช ฺฉ ฺฉุชุงุจ ุนูู ูโฺฉููุฏ ฺฉู ุฏุณุชุฑุณ ุณุฑุน ุจู ุฏุงุฏูโูุง ุฑุง ููฺฉู ูโุณุงุฒุฏ.

---

## ฑ. ุงูุฏฺฉุณโูุง ฺุฌูุฑ ุฐุฎุฑู ูุดูุ

### ุณุงุฎุชุงุฑูุง ุฏุงุฏูโุง ูุนููู ุจุฑุง ุฐุฎุฑู ุงูุฏฺฉุณโูุง

ุงูุฏฺฉุณโูุง ูุนูููุงู ุงุฒ ฺฉ ุงุฒ ุงู ุณุงุฎุชุงุฑูุง ุฏุงุฏูโุง ุงุณุชูุงุฏู ูโฺฉููุฏ:

### ุงูู) B-Tree (Balanced Tree)

- **ูพุฑุงุณุชูุงุฏูโุชุฑู ุณุงุฎุชุงุฑ** ุฏุฑ ุฏุชุงุจุณโูุง ุฑุงุจุทูโุง ูุงููุฏ PostgreSQLุ MySQL ู SQL Server.
- ุฏุงุฏูโูุง ุจูโุตูุฑุช **ูุฑุชุจ ุดุฏู** ุฏุฑ ฺฉ ุฏุฑุฎุช ูุชูุงุฒู ุฐุฎุฑู ูโุดููุฏ.
- ูุฑ ููุฏ ูโุชูุงูุฏ ฺูุฏู ฺฉูุฏ ู ุงุดุงุฑูโฺฏุฑ ุจู ูุฑุฒูุฏุงูุด ุฏุงุดุชู ุจุงุดุฏ.
- ุนููุงุช **ุฌุณุชุฌู (O(log n)ุ ุฏุฑุฌ (O(log n ู ุญุฐู (O(log n.

๐น **ูุญูู ุฐุฎุฑู ุฏุฑ ุฏุณฺฉ:**

- ูุฑ ููุฏ ุฏุฑ ฺฉ **page** ุงุฒ ุฏุณฺฉ ุฐุฎุฑู ูโุดูุฏ (ูุซูุงู ุฏุฑ PostgreSQL ุณุงุฒ ุตูุญู ธKB ุงุณุช).
- ุฏุณุชุฑุณ ุจู ููุฏูุง ูุงูุฏ ู ูุฑุฒูุฏ ุจู ฺฉูฺฉ ุงุดุงุฑูโฺฏุฑูุง ุฏุฑ ุตูุญูโูุง ูุฎุชูู ุตูุฑุช ูโฺฏุฑุฏ.

[[B-Tree]]

### ุจ) Hash Index

- ุจุฑ ุงุณุงุณ ููุฏุงุฑ ูุด ฺฉูุฏูุง ฺฉุงุฑ ูโฺฉูุฏ.
- ุฏุณุชุฑุณ ุณุฑุน **O(1)** ุฏุงุฑุฏุ ูู ุจุฑุง **ุฑูุฌ ฺฉูุฆุฑ**โูุง ููุงุณุจ ูุณุช.
- ุงPostgreSQL ุงุฒ ุขู ูพุดุชุจุงู ูโฺฉูุฏ ุงูุง ุฏุฑ ููุงุณู ุจุง B-Tree ฺฉูุชุฑ ุงุณุชูุงุฏู ูโุดูุฏ.

### ุฌ) GiST (Generalized Search Tree)

- ุจุฑุง ุงูุฏฺฉุณโูุง ุฎุงุต ูุซู ุฌุณุชุฌู ูุชูุ ุฏุงุฏูโูุง ูุถุง (PostGIS) ู ุฏุงุฏูโูุง ฺูุฏุจุนุฏ.

### ุฏ) GIN (Generalized Inverted Index)

- ูุฎุตูุต ุฌุณุชุฌู **ูุชู ฺฉุงูู (Full-Text Search)** ู ุขุฑุงูโูุง.
- ุฏุฑ PostgreSQL ุจุฑุง ููุฏูุง ฺฉู ููุฏุงุฑุดุงู ุดุงูู ฺูุฏ ููุฏุงุฑ ููฺฉู ุงุณุช (ูุซูุงู `tags` ฺฉู ุดุงูู ฺูุฏู ุชฺฏ ุงุณุช).

---

## ฒ. Heap Fetch ฺูุ 

### ุงPage ฺุณุชุ

- ุฏุชุงุจุณโูุง ุฏุงุฏูโูุง ุฑุง ุฏุฑ **ุจูุงฺฉโูุง ุซุงุจุช (Pages)** ุฐุฎุฑู ูโฺฉููุฏ.
- ูุซูุงู ุฏุฑ PostgreSQL ุงูุฏุงุฒู ูุฑ Page **ธKB** ุงุณุช.
- ูุฑ Page ุดุงูู **ฺูุฏู ุณุทุฑ (Tuple)** ุงุณุช.

### ุงHeap Fetch ฺูุ

ููุช ฺฉ ุงูุฏฺฉุณ ุงุณฺฉู ุงูุฌุงู ูุดูุ ูุชุฌูโ ุงูู **ุขุฏุฑุณ ูุฒฺฉ ุณุทุฑูุง ุฏุฑ heap table**ู. ุฏุชุงุจุณ ุจุงุฏ **ุณุทุฑูุง ูุงูุน** ุฑุง ุงุฒ heap ุจุฎููู ู ุงูู ุฑุง ุจุฑฺฏุฑุฏููู. ุงุณู ุงู ฺฉุงุฑ **heap fetch**ู.

๐น **ฺุฑุง Heap Fetch ูุดฺฉูโุณุงุฒ ุงุณุชุ**

- ุจุงุนุซ **IO ุงุถุงูู** ูโุดูุฏ ฺูู ุฏุชุงุจุณ ุจุงุฏ **ุฏู ุจุงุฑ** ุจู ุฏุณฺฉ ูุฑุงุฌุนู ฺฉูุฏ (ฺฉโุจุงุฑ ุงูุฏฺฉุณ ู ฺฉโุจุงุฑ ุฏุงุฏู ูุงูุน).
- ุจูููโุณุงุฒ: **Covering Index** (ุงูุฏฺฉุณ ฺฉู ุชูุงู ุฏุงุฏูโูุง ูุงุฒู ุฑุง ุดุงูู ุดูุฏ) ุงู ูุดฺฉู ุฑุง ฺฉุงูุด ูโุฏูุฏ.

---

## ณ. ุขุง ฺฉูุฆุฑโูุง ูุง ููุดู ุงุฒ ุงูุฏฺฉุณ ุงุณุชูุงุฏู ูโฺฉููุฏุ

ุฎุฑุ ููุดู ุงูุฏฺฉุณ ุงุณุชูุงุฏู ููโุดูุฏ. ุจุณุชฺฏ ุจู ูุฒูู ุงุฌุฑุง ฺฉูุฆุฑ ุฏุงุฑุฏ. ุงููุงุน ุฑูุดโูุง ุงุณฺฉู:

### ุงูู) Index Scan
- ุฏุชุงุจุณ ูุณุชููุงู ุงูุฏฺฉุณ ุฑุง ุฌุณุชุฌู ูโฺฉูุฏ.
- ุงฺฏุฑ ุณุทุฑูุง ฺฉู ููุฑุฏูุงุฒ ุจุงุดุฏุ ฺฉุงุฑุขูุฏ ุงุณุช.
- ุฏุฑ ุตูุฑุช ฺฉู ุฏุชุง ูุงุฒู ุฏุฑ ุงูุฏฺฉุณ ุจุงุดุฏุ Heap Fetch ููฺฉู ุงุณุช ุญุฐู ุดูุฏ (**Covering Index**).

### ุจ) Bitmap Index Scan
- ุฒูุงู ฺฉู **ุจุฎุด ุจุฒุฑฺฏ ุงุฒ ุฌุฏูู** ูุงุฒ ุงุณุช ูู ฺฉู ุฌุฏูู ูู. ูุฑู ู ุงูู page ูุง ฺฉู ุฏุชุง ุชูุด ูุณุช  ุฑู ูุณุช ูฺฉูู ฺฉู ู ุจุงุฑ io ุจุฒูู ุจุฑุง ุฎููุฏู 
- ุงฺฏู ุฏูุชุง ุงูุฏฺฉุณ ุจุงุดูุ ุงูุฏฺฉุณโูุง ุฑุง **ุชุฑฺฉุจ** ูโฺฉูุฏ ู ุจุนุฏ page ูุงุดูู ุฑู ุจุง ูู ูุฑุฌ ูฺฉูู ู ุงุดุชุฑุงฺฉุงุช ุฑู ูฺฏู ูุฏุงุฑู.

### ุฌ) Sequential Scan (Full Table Scan)
- ุงฺฏุฑ ุฏุชุงุจุณ ุจูููุฏ ฺฉู ุฎููุฏู ฺฉู ุฌุฏูู ุณุฑุนโุชุฑ ุงุฒ ุงูุฏฺฉุณูุ **ุฌุฏูู ุฑุง ูุณุชููุงู ูโุฎูุงูุฏ**.

**ฺฺฏููู ุจูููู ฺฉุฏุงู ุงุณฺฉู ุงุณุชูุงุฏู ุดุฏูุ**

- ุฏุฑ PostgreSQL ุงุฒ `EXPLAIN ANALYZE` ุงุณุชูุงุฏู ฺฉูุฏ.

---

## ด. ุฑโ ุงูุฏฺฉุณ ฺูุ ฺฉ ุจุงุฏ ุงู ฺฉุงุฑู ุจฺฉููุ

### ุง**Reindex ฺุณุชุ**

- ุงูุฏฺฉุณโูุง ููฺฉู ุงุณุช ุจู ูุฑูุฑ ุฒูุงู **ูุชูุฑู (Bloat)** ุดููุฏุ ุนู ุดุงูู ูุถุงูุง ุฎุงู ุง ุจูุงุงุณุชูุงุฏู ุดููุฏ.
- ุจุง **REINDEX** ุฏุชุงุจุณ ุงูุฏฺฉุณ ุฑุง ุงุฒ ูู ูโุณุงุฒุฏ.

### **ฺู ุฒูุงู REINDEX ฺฉููุ**

๐น **ุงูุฏฺฉุณ ุฎู ุจุฒุฑฺฏ ุดุฏู ู ุจุงุนุซ ฺฉูุฏ ุดุฏู ุงุณุช.**  
๐น ุง**Vacuum ุงูุฏฺฉุณ ุฑุง ุจููู ูฺฉุฑุฏู ุงุณุช.**  
๐น **ุฎุฑุงุจ (corruption) ุฏุฑ ุงูุฏฺฉุณ ุฑุฎ ุฏุงุฏู ุงุณุช.**  
๐น **ุจุนุฏ ุงุฒ bulk delete ุญุฌู ุฒุงุฏ ุงุฒ ุฏุงุฏู ุญุฐู ุดุฏู ุงุณุช.**

---
## ุฑู ุฏุชุงุจุณ ูพุฑูุฏุงฺฉุดู ฺุฌูุฑ ุงูุฏฺฉุณ ุจุณุงุฒูุ
**ุจูโุตูุฑุช ุฏูุงูุช (`CREATE INDEX` ุนุงุฏ)ุ ุฌุฏูู ุจุฑุง ุนููุงุช ููุดุชู (INSERT, UPDATE, DELETE) ููู ูโุดู (LOCK).** ุนู ุชุง ููุช ฺฉู ุงูุฏฺฉุณ ุณุงุฎุชู ูุดุฏูุ ูฺ ุชุบุฑ ุฑู ุฌุฏูู ุงูุฌุงู ููโุดู.


ูู ูุชููู ุจู ุตูุฑุช ฺฉุงูฺฉุงุฑูุช ูู ุงูุฏฺฉุณ ุจุณุงุฒู:
ุฏุฑุณุชู ฺฉู `CREATE INDEX CONCURRENTLY` ุฌุฏูู ุฑู **ุจุฑุง ุนููุงุช ููุดุชู (INSERT, UPDATE, DELETE) ููู ููโฺฉูู**ุ ุงูุง ุฏุฑ ูุฑุญูู ุขุฎุฑ ู ููู **ุฎู ฺฉูุชุงู ู ุณุจฺฉ (Short Lock)** ุจุฑุง ุณูฺฉ ฺฉุฑุฏู ุชุบุฑุงุช ูุงุฒ ุฏุงุฑู. ุชุง ฺุฒ ูู ุงุฒ ุฏุณุช ูุฏู

### **๐ ูพุณ ูุฑุขูุฏ ุฏูู ฺูุ**

1๏ธโฃ **ุงุณฺฉู ุงูู**: ฺฉู ุฌุฏูู ุฎููุฏู ูโุดู ู ุงูุฏฺฉุณ ุณุงุฎุชู ูโุดู.  
2๏ธโฃ **ุงุณฺฉู ุฏูู**: ุชุบุฑุงุช ุฌุฏุฏ ุงุนูุงู ูโุดู.  
3๏ธโฃ **ฺฉ ููู ุฎู ฺฉูุชุงู (Short Lock)** ุฑู ุฌุฏูู ุงุนูุงู ูโุดู ุชุง ูุทูุฆู ุจุดู ููู ุฑฺฉูุฑุฏูุง ุฌุฏุฏ ูู ุฏุฑ ุงูุฏฺฉุณ ูุฑุงุฑ ุฏุงุฑู.

### **ูพุณ ุขุง ููฺูุงู ุงุญุชูุงู ุงุฒ ุฏุณุช ุฑูุชู ุฏุชุง ูุฌูุฏ ุฏุงุฑูุ**

**ุฎุฑุ PostgreSQL ุจูโุตูุฑุช ุฏุงุฎู ููู ุชุบุฑุงุช ุฑู ูุฏุฑุช ูโฺฉูู.** ๐  
ุฏููุด ุงูู ฺฉู ููุช `CREATE INDEX CONCURRENTLY` ุงุฌุฑุง ูโุดูุ ุชุบุฑุงุช ุฌุฏุฏ **ููฺูุงู ุฏุฑ WAL (Write-Ahead Log) ุซุจุช ูโุดู** ู ุฏุฑ ููุงุช ููู ุฏุฑ ุงูุฏฺฉุณ ุงุนูุงู ูโุดู.
[[ACID#Durability]]

### **๐ ุชูุงูุช ููู ุฏุฑ `CREATE INDEX` ูุนููู vs `CONCURRENTLY`**

| ุฑูุด                         | ุขุง ุฌุฏูู ููู ูโุดูุฏุ                  | ุขุง ฺูุฏ ุงุณฺฉู ุงูุฌุงู ูโุฏูุฏุ | ุขุง ุงูฺฉุงู ุงุฒ ุฏุณุช ุฑูุชู ุฏุชุง ูุฌูุฏ ุฏุงุฑุฏุ            |
| --------------------------- | ------------------------------------- | -------------------------- | ------------------------------------------------ |
| `CREATE INDEX` (ุนุงุฏ)       | โ ุจููุ ุชุง ูพุงุงู ฺฉุงุฑ ููู ูโุดูุฏ        | โ ููุท ฺฉ ุจุงุฑ ุงุณฺฉู ูโฺฉูุฏ   | โ ุฎุฑุ ฺูู ุฌุฏูู ููู ุงุณุช                          |
| `CREATE INDEX CONCURRENTLY` | ๐ ููุท ฺฉ ููู ุฎู ฺฉูุชุงู ุจุฑุง ูุชุงุฏุชุง | โ ุฏู ุจุงุฑ ุงุณฺฉู ูโฺฉูุฏ       | โ ุฎุฑุ ฺูู ุชุบุฑุงุช ุฌุฏุฏ ูู ุฏุฑ ุงูุฏฺฉุณ ุซุจุช ูโุดููุฏ |
## ูฺฉุงุช ุจุฑุง ุงูุฏฺฉุณ

- **ุงูุฏฺฉุณ ุงุถุงูู ูฺฉูุฏ ูฺฏุฑ ูุงุฒู ุจุงุดุฏ!** ูุฑ ุงูุฏฺฉุณ ููฺฏุงู **ููุดุชู** ุจุงุนุซ ูุฒูู ุงุถุงู ูโุดูุฏ.  
- **ุงูุฏฺฉุณ ุฑู ุณุชููโูุง ุฒุงุฏ ุงุฌุงุฏ ูฺฉูุฏ!** ุงูุฏฺฉุณโูุง ฺูุฏุณุชููู ููุท ุฏุฑ ุดุฑุงุท ุฎุงุต ููุฏูุฏ.  
- **ุงุฒ `EXPLAIN ANALYZE` ุจุฑุง ุจุฑุฑุณ ฺฉุงุฑุง ุงุณุชูุงุฏู ฺฉูุฏ.**  
- **ุงูุฏฺฉุณโูุง ฺฉู ุงุณุชูุงุฏู ููโุดููุฏ ุฑุง ุญุฐู ฺฉูุฏ!** (`pg_stat_user_indexes` ุจุฑุง ูพุฏุง ฺฉุฑุฏู ุงูุฏฺฉุณโูุง ุจูุงุงุณุชูุงุฏู).  
- **ุชุฑุชุจ ูุฏุงุดุชู ู ุชูุฒุน ุชุตุงุฏู UUID โ ุจุงุนุซ Fragmentation ู ฺฉูุฏ ุฏุฑุฌ ูโุดู**

**ูุดฺฉู:**

- ุง**UUIDูุง ุจูโุตูุฑุช ุชุตุงุฏู ุชููุฏ ูโุดู** ู ุชุฑุชุจ ุฎุงุต ูุฏุงุฑู. ููุช ู UUID ุฌุฏุฏ ุงุถุงูู ูโฺฉูุ ููฺฉูู ูุณุท ุฏุฑุฎุช ูุฑุงุฑ ุจฺฏุฑูุ ูู ุงูุชูุง.
- ุงู ุนู ุฏุฑ **[[B+Tree]] ุง [[B-Tree]]ุ ูุฑุชุจุงู ููุฏูุง ูุงู ุฏฺุงุฑ ุชุบุฑ ูโุดู**ุ ุชูุณู ฺฏุฑู (Node Splitting) ุงุชูุงู ูโุงูุชู ู ุฏุฑุฎุช ุงุฒ ุชุนุงุฏู ุฎุงุฑุฌ ูโุดู.
- **ูุชุฌู:** ุฏุฑุฌโูุง ฺฉูุฏุชุฑ ูโุดูุ ฺูู ุจุงุฏ ุณุงุฎุชุงุฑ ุฏุฑุฎุช ุฑู ูุฑุชุจุงู ุจุงุฒุณุงุฒ ฺฉูู.

**ููุงุณู:**  
โ ุงฺฏู ู ุงูุฏฺฉุณ ุนุฏุฏ ุง ุฒูุงูโุจูุฏโุดุฏู (ูุซูุงู `AUTO_INCREMENT` ุฏุฑ MySQL) ุงุณุชูุงุฏู ุจุดูุ ุฏุงุฏูโูุง ุจูโุตูุฑุช ุชุฑุชุจ ุงุถุงูู ูโุดู ู ุฏุฑุฎุช ุฑุดุฏ ฺฉููุงุฎุช ุฏุงุฑู.  
โ ูู **UUID ุชุตุงุฏู ุจุงุนุซ ูโุดู ฺฉู ูุฑ ุฏุฑุฌุ ูุงุฒ ุจู ุฌุงุจุฌุง ุฒุงุฏ ุฏุงุดุชู ุจุงุดู** ู ุงู ฺฉุงุฑุง ุฑู ฺฉุงูุด ูโุฏู.

### **ุญุฌู ุจุงูุง UUID โ ูุตุฑู ุฒุงุฏ ุญุงูุธู ู ฺฉุงูุด ฺฉุงุฑุง ฺฉุด (Cache Misses)**

**ูุดฺฉู:**

- ุงUUID **16 ุจุงุช (128 ุจุช)** ูุณุชุ ุฏุฑ ุญุงู ฺฉู ฺฉ ุนุฏุฏ `BIGINT` ููุท **8 ุจุงุช (64 ุจุช)** ูุถุง ูโฺฏุฑู.
- ููุช ุงูุฏฺฉุณ ุฑู UUID ุจุงุดูุ ุงูุฏุงุฒู ููุฏูุง ุฏุฑุฎุช ุจุฒุฑฺฏโุชุฑ ูโุดู ู ุงู ุจุงุนุซ ูโุดู ฺฉู **ุฏุงุฏูโูุง ฺฉูุชุฑ ุชู ูุฑ ุตูุญู ุญุงูุธู ุฌุง ุจุดู**. ู ุฌุงููพ ูุงููู ุจุดุชุฑ ุดู ู io ุจุดุชุฑ ุฏุงุดุชู ุจุงุดู.
- ุงู ุนู ุฏุฑ ูพุงฺฏุงู ุฏุงุฏูุ ููุช ูโุฎูุงู ุฏุงุฏูโุง ุฑู ุฌุณุชุฌู ฺฉููุ ุจู ุชุนุฏุงุฏ ุจุดุชุฑ **ุตูุญู ุฏุณฺฉ (Disk Pages)** ูุงุฒ ุฏุงุฑู ู ูุฑุฎ ฺฉุด ุดุฏู ุฏุงุฏูโูุง (Cache Hit Rate) ฺฉู ูโุดู.
- **ูุชุฌู:** ุณุฑุนุช ุฌุณุชุฌู ฺฉุงูุด ูพุฏุง ูโฺฉููุ ฺูู ุฏุณุชุฑุณ ุจู ุฏุณฺฉ ุจุดุชุฑ ุงุฒ RAM ุทูู ูโฺฉุดู.

**ููุงุณู:**  
โ ุงฺฏุฑ ุจูโุฌุง UUID ุงุฒ ู ฺฉูุฏ ุนุฏุฏ (`BIGINT` ุง `AUTO_INCREMENT`) ุงุณุชูุงุฏู ฺฉููุ ุงูุฏุงุฒู ุงูุฏฺฉุณ ุฎู ฺฉูฺฺฉโุชุฑ ูโุดูุ ุฏุงุฏูโูุง ุจุดุชุฑ ุชู RAM ฺฉุด ูโุดู ู ุฏุณุชุฑุณโูุง ุณุฑุนโุชุฑู.  
โ ูู UUIDูุง ุจุงุนุซ ูโุดู ฺฉู ุญุงูุธู ุจุดุชุฑ ูุตุฑู ุจุดู ู ูุฑุฎ ฺฉุด ุดุฏู ุฏุงุฏูโูุง ูพุงู ุจุงุฏ.

ูุชููู ุงุฒ [[Twitter Snowflake]] ุจุฑุง uuid ูุงููู ุงุณุชูุงุฏู ฺฉูู ุชุง ูู ุชุฑุชุจ ุจุงุดู ูู ฺฉูุชุงู ุชุฑ ู ูู ุงุฏ ุฏุชุงุจุณ ุฑู ุจู ูุฒุฑ ูุฏู